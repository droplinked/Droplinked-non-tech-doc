# Shipping

# Shipping

**Feature ID:** CHK-SHIPPING-302

**Category:** Checkout Domain | Shipping

**Actors:** Customer

**Status:** Released

**Owner:** Behdad

**Last Updated:** January 31, 2026

---

# **1) Summary**

### **Problem / Value**

For carts that include **physical** or **POD (Print on Demand)** products, shipping costs must be calculated based on the customer's active address. This happens dynamically within the Single Page Checkout. The system must group products with similar shipping logic and present available options clearly.

### **Desired Outcome**

- Automatically load Shipping options when the **Delivery Details** (Address) form is completed.
- Display a **Grouping** of products that share shipping methods (Showing product thumbnails for context).
- For each group, list available shipping rates (Service Name, Price, Estimated Date).
- Select the **First Option** by default for each group.
- Allow users to click "View More" to expand the list if many options exist.
- If no shipping is available for a group/address, display a blocking error with a removal option.
- Update the **Sidebar** total in real-time when a selection changes.

---

# **2) Scope â€“ In / Out**

### **In Scope**

- **Auto-Loading:** Triggered by address form completion.
- **Grouping:** Group POD items together; Group Physical items by Merchant Shipping System.
- **Visuals:** Display thumbnails of items in each shipping group.
- **Selection:** First option default; "View More" for expanded list.
- **Error Handling:** "These items can't be shipped to your address." + "Remove Items" button.

### **Out Scope**

- **Address Entry:** Handled in the "Delivery Details" section (Single Page Checkout).
- **Separate Page:** Shipping is no longer a separate step/page.

---

# **3) Key User Journeys**

**Journey 1: Successful Selection**

1. Customer completes Address form.
2. Shipping section shows "Loading...".
3. System displays one or more shipping groups.
4. Each group shows product thumbnails and a selected default rate.
5. Customer changes a rate.
6. Sidebar updates Total immediately.

**Journey 2: Unshippable Address**

1. Customer completes Address form.
2. System determines one group cannot ship to this location.
3. Display: "These items can't be shipped to your address."
4. Action: Customer clicks "Remove Items".
5. System removes those specific items from cart and recalculates totals.

---

# **4) Business Acceptance Criteria (BAC)**

- **BAC 1:** Shipping search MUST trigger automatically after Delivery Details are filled.
- **BAC 2:** Products sharing the same shipping logic MUST be visually grouped with their thumbnails.
- **BAC 3:** If shipping is found, the first option MUST be pre-selected.
- **BAC 4:** "View More" MUST be displayed if there are hidden options to keep the UI clean.
- **BAC 5:** The sidebar MUST reflect the sum of all selected shipping costs.
- **BAC 6:** If no shipping is found, the user MUST be blocked from proceeding and offered a "Remove Items" action.

### ðŸ“œ Change Log

| Date | Author | Description of Changes | Reason |
| --- | --- | --- | --- |
| 2026-01-31 | Copy/Paste AI | Update for Single Page Checkout | Re-architecture |

---

---

# [PART 2: AI REFERENCE SPEC]

### B1) Definitions & Glossary

- **Shipping Group:** A subset of cart items that are shipped from the same origin or using the same carrier logic (e.g., all POD items vs. Merchant Warehouse items).
- **Default Selection:** The cheapest or first returned rate is auto-selected to reduce friction.

### B2) Detailed Functional Rules (Numbered)

- **R1. Trigger:** Logic listens for `AddressForm.isValid` = true.
- **R2. Visualization:**
    - Header: "Shipping Method"
    - Body: List of Groups.
    - Group Header: Row of product thumbnails included in this shipment.
    - Group Body: List of Radio Buttons (Rate Name - Price).
- **R3. Default State:** First option in the list is `checked`.
- **R4. View More:** If Options > 3 (configurable), show top 3 and a "View More" toggle.
- **R5. Error State (No Rate):**
    - Text: "These items can't be shipped to your address."
    - Button: "Remove Items".
    - Logic: Button removes ONLY the items in this failing group from the cart.
- **R6. Real-time Cart Update:** Changing a radio button selection immediately sends a request to update the cart summary (Sidebar).

### B3) UI/UX States & Triggers

- **Loading:** Skeleton loader replaces the shipping area while fetching rates.
- **Loaded:** Groups appear.
- **Selection Change:** Sidebar values flash/update.

### B4) Edge Cases & Error Handling

- **EC1. Timeout:** If shipping rates fail to load, allow "Retry".
- **EC2. Address Edit:** If user goes back up and edits address, Shipping Options reset and reload.

### B5) Data Requirements & API Contracts

- **Input:** Zip, Country, State, City, Cart Items.
- **Output:** Array of Shipping Groups -> Array of Rates { id, name, price, estimated_days }.

### B6) Logical Flow & Pseudo-code

```
ON Address_Update:
  SET Status = Loading
  FETCH Rates(Address, Items)

  IF Rates.isEmpty OR Error:
     RENDER ErrorMessage("No shipping to this address")
     RENDER Button("Remove Items")
  ELSE:
     FOREACH Group in Rates:
        RENDER Thumbnails(Group.items)
        RENDER RadioList(Group.rates)
        SELECT Group.rates[0]
     ENDFOREACH
     UPDATE Sidebar(TotalShippingCost)
  ENDIF

```

### B7) Testing Matrix for AI

- **T1:** Enter Valid Address > Verify Default Shipping Selected > Verify Sidebar matches.
- **T2:** Change Selection > Verify Sidebar Price updates.
- **T3:** Enter Restricted Address > Verify Error Message appears > Click Remove Items > Verify Cart Quantity Decreases.
- Default selection of first shipping option in each group.
- Updating shipping total in the checkout summary panel.
- Saving selected shipping methods to the cart.
- Proceeding to next checkout stage only after selection is complete.