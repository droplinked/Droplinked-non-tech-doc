# Checkout

# Checkout Flow - High Level Overview

**Document Type:** Product Overview

**Category:** Checkout Domain | User Journey

**Status:** Documentation

**Owner:** Product Management

**Last Updated:** December 27, 2025

---

# **1) Overview**

This document maps the end-to-end customer journey through checkout, from cart entry to order confirmation.

**Product Types Supported:**

- **Physical Products** - Tangible goods requiring shipping
- **Digital Products** - Downloadable items (no shipping)
- **Print on Demand (POD)** - Custom-manufactured items

**Cart Flexibility:** Cart can contain any combination of product types (Digital, Physical, POD, or mixed). The flow adapts based on cart composition and merchant configuration.

---

# **2) Checkout Journey Map**

## **2.1 Entry Points**

Customers enter checkout through:

1. **Storefront** - Direct "Checkout" button click from cart page
2. **Public API** - Direct checkout link generation
3. **Deep Link** - URL-based cart restoration

---

## **2.2 Complete User Flow**

```
┌─────────────────────────────────────────────────────────────┐
│                    CHECKOUT JOURNEY                         │
└─────────────────────────────────────────────────────────────┘

Step 1: Cart Loading & Summary Display
   ↓
Step 2: Customer Information Collection
   ├─ Digital-Only Cart → Email + Note
   └─ Physical/POD Cart → Email + Note + Full Address
   ↓
Step 3: Address Validation (Physical/POD Only)
   ├─ Valid Address → Continue
   └─ Invalid Address → Warning + Manual Override Option
   ↓
Step 4: Shipping Method Selection (Physical/POD Only)
   ├─ Group Products by Shipping Rules
   ├─ Display Available Options per Group
   ├─ Auto-Select First Option
   └─ Customer Confirms or Changes Selection
   ↓
Step 5: Review & Apply Discounts
   ├─ View Order Summary
   ├─ Apply Coupon Code (Optional)
   └─ See Updated Totals
   ↓
Step 6: Payment Method Selection
   ├─ If Total = $0 → Skip to Order Confirmation
   └─ If Total > $0 → Select Payment Method
       ├─ Fiat: Stripe, PayPal, Coinbase
       └─ Crypto: Native Tokens (Various Networks)
   ↓
Step 7: Order Creation & Payment Processing
   ├─ Create Order Record
   ├─ 2-Hour Payment Window Starts
   └─ Process Payment
       ├─ Success → Order Confirmed
       └─ Failure → Order Failed + Log Entry
   ↓
Step 8: Order Confirmation Page
   ├─ Display Complete Order Details
   ├─ Show Payment Status (Real-time Update)
   ├─ Clear Shopping Cart
   └─ "Back to Shop" Navigation

```

---

# **3) Detailed Step-by-Step Breakdown**

## **Step 1: Cart Loading & Summary Display**

- System loads cart and computes all costs via [Cart Calculation Engine](https://www.notion.so/Calculation%202b4a781ca509809ea1b9f40c01d234cb.md)
- Summary panel displays: Items, Shipping, Tax, Total Payment
- System detects product types and determines required form fields

---

## **Step 2: Customer Information Collection**

### **Digital-Only Cart:**

- Email (mandatory) - pre-filled if user is authenticated
- Note (optional)
- Proceeds directly to Payment & Review (Step 5)

### **Physical/POD or Mixed Cart:**

- Name, Email, Phone Number
- Email (pre-filled if user is authenticated; read-only for authenticated users)
- Full Address: Address Line 1, Line 2 (optional), Country, City, State, Zip Code
- Address form details: See [Checkout Address Form](https://www.notion.so/Checkout/Checkout%20Address%20Form%202cba781ca50980979fcac9c865d0177a.md) for complete specification
- Phone validated for selected country
- **On "Next" button click:** Triggers address validation and tax recalculation (Step 3)

**Note:** Steps 2 & 3 occur on the same page. User enters information, clicks "Next", and validation + tax recalculation happen before navigation.

---

## **Step 3: Address Validation & Tax Recalculation (Physical/POD Only)**

**Triggered when:** User clicks "Next" button on Step 2

**Process:**

- Google API validates address format and deliverability
- Tax is automatically recalculated based on validated address and shipping destination
- **If Valid Address:** Tax updated in cart summary, navigate directly to Shipping Step (Step 4)
- **If Invalid Address:**
    - Warning modal appears: "We could not verify this address. It may result in delivery issues."
    - User options:
        - **Edit Address** - Return to form to correct information
        - **Continue Anyway** - Manual override, proceed to Shipping Step
    - Tax remains based on address entered (valid or manually confirmed)
    - After user confirmation → Navigate to Shipping Step

---

## **Step 4: Shipping Method Selection (Physical/POD Only)**

**Grouping Logic:**

- **POD Products:** All POD items share the same shipping options (grouped together)
- **Physical Products:** Grouped based on merchant-configured shipping system
    - Merchant selects shipping system for each physical product during product creation in dashboard
    - Products using the same shipping system are grouped together

**Display Per Group:**

- Product thumbnails for items in that group
- Available shipping methods with:
    - Service Name (e.g., "Standard Shipping", "Express")
    - Fulfillment Date
    - Shipping Price
    - Estimated Delivery Date
- First option auto-selected per group
- **Important:** Shipping costs are NOT automatically added to cart total. After customer selects and clicks "Next", shipping selections are saved and amounts added to order summary.

**Confirmation & Update:**

- Customer reviews and confirms selections
- Clicks "Next" to proceed
- Shipping costs are finalized and displayed in order summary
- Order summary updates with new total including shipping

---

## **Step 5: Review & Apply Discounts**

- Full cart breakdown: Items, Shipping, Tax, Subtotal
- Optional coupon code application

**Coupon Validation Rules:**

- Coupon must belong to this specific shop
- Coupon must exist in the system
- Coupon must not have been used before
- Discount types: Percentage or Fixed Amount
- One coupon per cart

**Behavior:**

- Totals update immediately after valid coupon is applied
- Invalid coupons show error message
- May result in $0 total (free order)

---

## **Step 6: Payment Method Selection**

### **Zero-Total Cart ($0):**

- Payment methods section hidden
- Skip directly to Order Creation
- Use cases: 100% discount, gift cards, promotional free orders

### **Paid Cart (Total > $0):**

- Display only merchant-enabled payment methods
    - **Configuration:** Merchant activates payment methods from dashboard settings
    - **Requirement:** At least one payment method must always be enabled (cannot be zero)
    - **No Restrictions:** No country-based limitations on payment methods

**Available Payment Methods:**

- **Fiat & 3rd Party:** Stripe (labeled as "Fiat"), PayPal, Coinbase Commerce
    - See [Payment Methods Display - Fiat & 3rd Party](https://www.notion.so/Checkout/Payment%20Methods%20Display%20-%20Fiat%20&%203rd%20Party%202b4a781ca50980b993b3d9001da679fd.md) for complete specification
- **Native Token Payments:** Various blockchain tokens supported
    - Tokens organized by network (Polygon, Binance, Ethereum, etc.)
    - Requires wallet extension and connection
    - See [Payment Methods Display - Native Token Payments](https://www.notion.so/Checkout/Payment%20Methods%20Display%20-%20Native%20Token%20Payments%202b4a781ca50980b993b3d9001da679fd.md) for complete specification and supported tokens

**User Action:**

- Customer selects one payment method
- For crypto payments: Wallet extension validation, connection, network verification, and balance check required before proceeding

---

## **Step 7: Order Creation & Payment Processing**

- Order record created with all cart details and initial status: **Pending**
- **Fiat Payments:** User redirected to payment gateway → System receives webhook/callback → Status updated
- **Crypto Payments:** Smart contract initiated → User confirms in wallet → Blockchain confirmation → Status updated

**Payment Window:**

- Order remains payable for **2 hours** after creation
- **No timer displayed** on confirmation page
- **Important:** If customer attempts to pay an order after the 2-hour window expires → System automatically creates a **NEW order** with current cart state
- Expired orders have no impact on inventory or cart state
- Customer can retry payment immediately with the new order
- Previous expired order remains in system with "Expired" or "Not Paid" status

**Payment Outcomes:**

- **Success:** Order status → Confirmed | Inventory updated | Commission calculations triggered | Confirmation email sent
- **Failure:** Order status → Failed | Log entry created with error details | Customer notified

---

## **Step 8: Order Confirmation Page**

**Displays:**

- **Payment Details:** Items (with thumbnails, SKU, quantity, subtotal), Shipping Cost, Tax, Coupon/Discount, Total Payment
- **Shipping Details:** Customer name, complete address, contact information
- **Order Information:** Order Status (Pending/Confirmed/Failed), Note (if entered), Payment Method used

**Real-Time Updates Mechanism:**

- Each user interaction triggers API call to refresh all data
- Status updates automatically without page refresh
- If user closes and reopens page → Cart can be retrieved via GET API call
- **Data Persistence:** Only data saved to API is retained; incomplete entries (e.g., partial address) are lost on page refresh

**System Actions:**

- Shopping cart automatically emptied after successful order confirmation
- "Back to Shop" button redirects to merchant storefront
- Session ready for next purchase

**Digital Products:** Immediately available for download after payment confirmation

---

# **4) Calculation & Revenue Logic**

The checkout flow integrates with the [Calculation Engine](https://www.notion.so/Calculation%202b4a781ca509809ea1b9f40c01d234cb.md) throughout the process to:

- Calculate cart totals (Items + Shipping + Tax - Discounts)
- Compute revenue split (Droplinked Share → Referral Share → Merchant Share)
- Route payments based on account connection status
- Apply negative balance protection when needed

See [Calculation documentation](https://www.notion.so/Calculation%202b4a781ca509809ea1b9f40c01d234cb.md) for detailed logic and formulas.

---

# **5) Key Decision Points & Conditional Logic**

## **Decision Tree**

```
┌─ Product Types in Cart?
│  ├─ Digital Only
│  │  ├─ Collect: Email + Note
│  │  └─ Skip: Address, Shipping
│  │
│  ├─ Physical/POD Only
│  │  ├─ Collect: Full Address + Contact
│  │  ├─ Validate: Google API
│  │  └─ Require: Shipping Selection
│  │
│  └─ Mixed (Digital + Physical/POD)
│     ├─ Collect: Full Address + Contact
│     ├─ Shipping: Only for Physical/POD items
│     └─ Digital products: Available for download immediately after payment
│
├─ Total After Discounts?
│  ├─ $0 → Skip Payment Methods
│  └─ > $0 → Show Payment Methods
│
├─ Payment Type?
│  ├─ Fiat → Gateway Redirect
│  └─ Crypto → Wallet Connection
│
└─ Payment Result?
   ├─ Success → Confirm Order + Digital Downloads Available
   ├─ Failure → Mark Failed + Log
   └─ Timeout (2hrs) → New Order Required for Payment

```

---

# **6) User Experience Principles**

- **Clarity:** Show current step, total cost at all times, clear error messages, real-time feedback
- **Flexibility:** Manual address override, multiple payment methods, optional fields clearly marked
- **Efficiency:** Auto-select defaults (shipping), smart form behavior, skip unnecessary steps
- **Trust:** Address validation for accuracy, real-time status updates, comprehensive order confirmation
- **Responsiveness:** Immediate calculation updates, live shipping cost changes, dynamic coupon application

---

# **7) Edge Cases & Handling**

## **Invalid Address Override**

- **Issue:** Customer insists on unverified address
- **Handling:** Warning modal with "Continue Anyway" option
- **Risk:** Potential delivery failure
- **Mitigation:** Clear responsibility transfer to customer

## **Payment Timeout**

- **Issue:** Customer attempts payment after 2-hour window
- **Handling:** System creates new order automatically
- **User Impact:** Can complete checkout with fresh order
- **Data:** Previous order retained for tracking

## **Mixed Cart (Digital + Physical)**

- **Handling:** Shipping step only processes Physical/POD items
- **Digital Products:** Immediately available for download after payment
- **User Experience:** Seamless handling of both product types

## **Coupon Edge Cases**

- Expired or invalid coupon → Rejected with error message
- Coupon already used → Rejected
- Results in negative total → Capped at $0
- Multiple coupon attempts → Only one allowed per cart

## **Zero-Total Orders**

- **Trigger:** 100% discount or gift cards
- **Flow:** Skip payment selection, create order immediately
- **Status:** Auto-confirmed (no payment processing needed)

## **Wallet Not Connected (Crypto)**

- **Issue:** User selects crypto but no wallet extension detected
- **Handling:** Warning message with installation guide
- **Alternative:** Suggest using fiat payment methods

---

**Document End**

# 

[Checkout](Checkout/Checkout%202d8a781ca50980d59e66f12afc59be25.md)

[Payment](Checkout/Payment%202d8a781ca50980b8abd2c22155bf4a8d.md)

[Order](Checkout/Order%202d8a781ca50980d6bb54c3884277ca80.md)