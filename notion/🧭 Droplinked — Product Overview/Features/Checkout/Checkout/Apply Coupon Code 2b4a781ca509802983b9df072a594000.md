# Apply Coupon Code

# Apply Coupon Code

**Feature ID:** CHK-PROMO-301

**Category:** Checkout Domain | Promotions

**Actors:** Customer

**Status:** Released

**Owner:** Behdad

**Last Updated:** January 31, 2026

---

# **1) Summary**

### **Problem / Value**

Customers expect to redeem promotional codes during checkout to receive discounts. This feature allows users to enter a code in the sidebar and instantly see the financial impact on their order.

### **Desired Outcome**

- **Input:** Dedicated field in the "Right Sidebar" of the Single Page Checkout.
- **Feedback:** Clear success messages (Green) or error messages (Red).
- **Calculation:** Discount applies to the **Subtotal** (Item Price * Qty) only. It does NOT reduce Shipping or Tax unless specifically configured (Start with Item-only logic).
- **Display:** Show the discount value explicitly in the sidebar financial summary.
- **Zero-Pay Handling:** If the discount covers 100% of the cost, the Payment Method section is skipped.

---

# **2) Scope â€“ In / Out**

### **In Scope**

- Text input + Apply button in Sidebar.
- Validation logic against backend.
- Success Message: `"{10% / $10.00} discount code applied"`.
- Real-time Sidebar update.
- $0 Total payment flow trigger.
- **Coupon blocking for affiliate products:** Display message that coupons cannot be applied to affiliate products.

### **Out Scope**

- Auto-applying coupons (must be entered manually).
- Stacking multiple coupons (Single code logic for now).

---

# **3) Key User Journeys**

**Journey 1: Apply Success**

1. Customer types `SAVE10`.
2. Clicks Apply.
3. Text turns Green: "10% discount code applied".
4. Sidebar adds row: "Discount: -$10.00".
5. Total updates.

**Journey 2: Apply Invalid**

1. Customer types `FAKE`.
2. Clicks Apply.
3. Text turns Red: "Invalid code".
4. Sidebar remains unchanged.

**Journey 3: Affiliate Product - Coupon Not Allowed**

1. Customer has affiliate product in checkout (direct checkout flow).
2. Customer tries to enter coupon code.
3. System detects affiliate product in order.
4. **Coupon input field is disabled/hidden**.
5. Message displayed: "Coupons cannot be applied to affiliate products".
6. Customer proceeds without coupon.

---

# **4) Business Acceptance Criteria (BAC)**

- **BAC 1:** Discount must calculate based on Item Subtotal.
- **BAC 2:** Valid code must display Green success text with value.
- **BAC 3:** Invalid code must display Red error text.
- **BAC 4:** Sidebar MUST show "Discount" line item.
- **BAC 5:** If Total == 0, disable/hide Payment Selection.
- **BAC 6:** **For orders containing affiliate products, coupon code input MUST be disabled or hidden.**
- **BAC 7:** **Message displayed for affiliate products: "Coupons cannot be applied to affiliate products".**

### ðŸ“œ Change Log

| Date | Author | Description of Changes | Reason |
| --- | --- | --- | --- |
| 2026-02-25 | Behdad | Added BAC 6-7: Coupon input disabled for affiliate products | Affiliate product requirements |
| 2026-01-31 | Copy/Paste AI | Updated UI feedback & $0 logic | Feature Update |

---

---

# [PART 2: AI REFERENCE SPEC]

### B1) Definitions & Glossary

- **Fixed Discount:** Deducts specific amount (e.g., $10).
- **Percentage Discount:** Deducts % of Subtotal (e.g., 10% of $100 = $10).

### B2) Detailed Functional Rules (Numbered)

- **R1. Input location:** Inside the Sticky Sidebar, below Item List, above Financials.
- **R2. Validation:**
    - Input: Alphanumeric.
    - Trigger: "Apply" button or Enter key.
- **R3. Success State:**
    - Message: `[Value] discount code applied` (Color: Green).
    - Action: Add `discount_amount` to Cart State. Recalculate Total.
- **R4. Error State:**
    - Message: `Invalid Coupon Code` or `Expired` (Color: Red).
- **R5. Calculation Constraint:** Discount is applied to Subtotal.
    - `Total = (Subtotal - Discount) + Shipping + Tax`.
    - If `Subtotal - Discount < 0`, treat as 0 (No negative totals).
- **R6. Zero Pay Trigger:**
    - IF `Total == 0`:
        - Hide `PaymentMethodComponent`.
        - Show `ConfirmOrderButton`.

### B3) UI/UX States & Triggers

- **Loading:** Spinner inside Apply button during validation check.

### B4) Edge Cases & Error Handling

- **EC1. Code expired during checkout:** If user applies code, but waits too long and it expires, checkout submit should re-validate and fail order if code is now invalid, prompting user to remove it.

### B5) Data Requirements & API Contracts

- **Input:** `code`
- **Output:** `{ valid: true, type: 'percent', value: 10, amount: 5.00 }`

### B6) Logical Flow & Pseudo-code

```
ON ApplyCode(Code):
  RESP = API.validate(Code)
  IF RESP.valid:
     SHOW_SUCCESS("{RESP.value} discount code applied")
     UPDATE_CART(Discount = RESP.amount)
     IF Cart.Total == 0:
        ENABLE_ZERO_PAY_MODE()
  ELSE:
     SHOW_ERROR("Invalid")

```

### B7) Testing Matrix for AI

- **T1:** Apply Valid Code > Check Sidebar Math.
- **T2:** Apply Invalid > Check Error.
- **T3:** Apply High Value Code > Check Total 0 > Check Payment Method Hidden.