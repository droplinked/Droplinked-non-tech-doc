# Tax Engine

**Feature ID:** CHK-TAX-003

**Category:** Checkout Domain | Cost Engines

**Actors:** Checkout Service, Tax Providers, Product Engine

**Status:** Released

**Owner:** Behdad

---

# **1) Summary**

We need a Tax Engine that determines tax for the cart using **one single tax rate**, returned by our internal tax service, based on **the customer’s shipping address**.

Rules:

- **Physical products → taxed**
- **POD products → taxed (same rate as Physical)**
- **Digital products → always 0 tax**

No merchant tax configurations.

No multiple tax rate types.

No POD-specific rate.

---

# **2) Tax Calculation Rules**

## **A) One Single Tax Rate**

Internal Tax API returns:

```
taxRate

```

This rate applies to:

- Physical items
- POD items

Digital items always → `0 tax`.

---

## **B) Physical Product Tax**

```
PhysicalTax = Σ (originalPrice * qty * taxRate)

```

---

## **C) POD Product Tax**

```
PODTax = Σ (originalPrice * qty * taxRate)

```

This POD tax amount must still be **sent to the POD provider** (Printful), but it uses the same rate.

---

## **D) Digital Product Tax**

```
DigitalTax = 0

```

---

# **3) Tax Flow (Updated)**

### **Step 1 — Classify items**

- physical
- pod
- digital

### **Step 2 — Fetch unified tax rate**

Example:

```json
{
  "taxRate": 0.08
}

```

### **Step 3 — Apply same tax rate to Physical + POD items**

### **Step 4 — Sum totals**

```
TotalTax = PhysicalTax + PODTax

```

Digital tax is always zero.

### **Step 5 — POD tax routing**

```
externalTaxToProvider.printful = PODTax

```

---

---

# **5) Business Acceptance Criteria**

### **BAC 1** — There is only **one tax rate** from internal tax API.

### **BAC 2** — Physical + POD both use the same tax rate.

### **BAC 3** — Digital items always produce 0 tax.

### **BAC 4** — Total tax = PhysicalTax + PODTax.

### **BAC 5** — Coupon discounts do NOT reduce taxable amounts.

### **BAC 6** — Tax is based only on customer shipping address.

### **BAC 7** — POD tax must be routed to external provider.

### **BAC 8** — Shipping is non–taxable.

### **BAC 9** — TaxSummary must match the schema.